<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>So2sdr : Bandmap tech info</title>
        <meta name="description" content="Amateur Radio contest logging with software-defined radio features">

        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/css/syntax.css">
        <link rel="stylesheet" href="/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class="row">
                <div id="header" class="col-sm-12">
                    <h4><a class="brand" href="/">So2sdr</a>
    <small>Amateur Radio contest logging with software-defined radio features</small>
</h4>

                </div>
            </div>

            <div class="row">
                
                
                    <div id="navigation" class="col-sm-2">
                        <ul class="nav nav-list">
    <li><a href="/">Home</a></li>
    
        
        

        
    
        
        

        
            
                <li class="nav-header">Changes</li>
            
            <li data-order="1"><a href="/changes/changelog.html">Changelog</a></li>
        
    
        
        

        
            
                <li class="nav-header">Install</li>
            
            <li data-order="1"><a href="/install/linux-installation.html">Linux</a></li>
        
    
        
        

        
            
                <li class="nav-header">Documentation</li>
            
            <li data-order="3"><a href="/doc/bandmap-tech-info.html">Bandmap tech info</a></li>
        
            
            <li data-order="2"><a href="/doc/reference.html">Reference</a></li>
        
            
            <li data-order="1"><a href="/doc/setup.html">Setup</a></li>
        
    
        
        

        
            
                <li class="nav-header">Support</li>
            
            <li data-order=""><a href="/support/support.html">Contacts</a></li>
        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class="divider"></li> first to break up the content. -->
</ul>

                    </div>

                    <div id="content" class="col-sm-10">
                        <div class="page-header">
    <h2>Bandmap tech info
        
    </h2>
</div>

<p>So2sdr-bandmap uses TCP/UDP as the most portable and flexible option.
So2sdr-bandmap accepts commands via TCP using a very simple
protocol. Commands are sent to so2sdr-bandmap as a string of bytes
(little-endian for multiple byte data):</p>

<p>byte 1  : command</p>

<p>byte 2  : length in bytes (up to 255) of following data packet. 
            minimum length is 0 if no data follows.</p>

<p>following bytes: data (optional), format depends on command</p>

<h3 id="general-commands">General commands</h3>
<hr />

<ul>
  <li>
    <p>Set Center Frequency: ‘f’ 0x66 dec 102
followed by ascii characters giving frequency in Hz</p>
  </li>
  <li>
    <p>Exit program: ‘q’ 0x71 dec 113
No data follows (length=0). Using this command before terminating
the  bandmap process allows the bandmap to shut down properly and
 update its config files.</p>
  </li>
  <li>
    <p>Set TX state: ‘t’ 0x74 dec 116
No data follows (length=0). If transmit state is set, the bandmap will stop   peak detecting signals and display the red “TX” icon.</p>
  </li>
  <li>
    <p>Set RX state: ‘r’ 0x72 dec 114 Cancels transmit state (see 0x74)</p>
  </li>
  <li>
    <p>Find open frequency: ‘g’ 0x67 dec 103 Finds an open frequency on the bandmap. This will only function after the center frequency has been set. The found frequency will be returned via UDP (see below).</p>
  </li>
  <li>
    <p>Set freq finder lower limit: ‘l’ 0x6C dec 108
  Set lower limit frequency for “Find open freq”
  followed by ascii characters giving frequency in Hz</p>
  </li>
  <li>
    <p>Set freq finder upper limit: ‘u’ 0x75 dec 117
  Set upper limit frequency for “Find open freq”
  followed by ascii characters giving frequency in Hz</p>
  </li>
  <li>
    <p>Set bandmap offset: ‘o’ 0x6f dec 111
 Set offset in Hz between frequency displayed and actual center freq.
 Followed by ascii characters giving offset in Hz.</p>
  </li>
  <li>
    <p>Set bandmap invert: ‘i’  0x69 dec 105
 If turned on, spectrum will be inverted. Useful for CW-reverse mode
 and some radios that have inverted IF on certain bands.
 Followed by single byte- if 0x00, sets invert off, any other byte
 sets invert on.</p>
  </li>
  <li>
    <p>Qsy to next higher signal:  ‘U’ 0x55 dec 85
 Length zero. Qsy’s to next higher marked signal (black dot) on band. The new frequency is returned to the controlling program via UDP.</p>
  </li>
  <li>
    <p>Qsy to next lower signal:  ‘D’ 0x44 dec 68
 Length zero. Qsy’s to next lower marked signal (black dot) on band. The new frequency  is returned to the controlling program via UDP.</p>
  </li>
</ul>

<h3 id="call-marking">Call marking</h3>
<hr />

<p>So2sdr-bandmap can display callsigns and optionally highlight the
actual CW signal of a station with a specific color. The program
stores a list of callsigns and frequencies that are currently being
displayed.  TCP commands are used to manage this list. The program is
not designed to intelligently manage this list (for example finding
dupes or removing calls after a set time), this is left up to the
managing TCP connection.</p>

<ol>
  <li>Add callsign: ‘a’ 0x61 dec 97
 followed by
    <ul>
      <li>command string length byte</li>
      <li>
        <p>command string:</p>

        <p>callsign,frequency,R1G1B1R2G2B2flag</p>

        <ul>
          <li>callsign = ASCII callsign data</li>
          <li>frequency = frequency in Hz</li>
          <li>R1 = byte giving red color value (0:255) for call</li>
          <li>G1 = byte giving green color value (0:255) for call</li>
          <li>B1 = byte giving blue color value (0:255) for call</li>
          <li>R2 = byte giving red color byte for signal: 0 or 1</li>
          <li>G2 = byte giving green color byte for signal: 0 or 1</li>
          <li>B2 = byte giving blue color byte for signal: 0 or 1</li>
          <li>flag = 0x00 means no highlight, any other value means highlight</li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<p>example: puts N4OGW on bandmap at 14035100 Hz, callsign in magenta
and signal higlighted in magenta:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    0x61 0x16 N4OGW,14035100,0xff 0x00 0xff 0x01 0x00 0x01 1
</code></pre></div></div>

<ol>
  <li>Delete callsign: ‘d’  0x64 dec 100
  followed by
    <ul>
      <li>length byte</li>
      <li>callsign</li>
    </ul>
  </li>
  <li>Clear all calls: ‘x’ 0x78 dec 120
command length 0</li>
</ol>

<h3 id="udp-broadcasts">UDP broadcasts</h3>
<hr />

<p>So2sdr-bandmap sends out UDP packets in response to several types
of events:</p>

<ul>
  <li>
    <p>clicking on the bandmap or a marked signal. The UDP packet contains
the new frequency:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;So2sdr&gt;
  &lt;bandmap RadioNr="1" freq="14037726"/&gt;
  &lt;/So2sdr&gt;
</code></pre></div>    </div>
  </li>
</ul>

<p>RadioNr is the bandmap ID number. A similar packet is broadcast in
response to a request to find an open frequency. Note that the frequency
is given in Hz.</p>

<ul>
  <li>
    <p>deleting a call with the mouse. The right-click menu gives the option
to delete a call. The bandmap itself does not delete the call from its
list, this should be done by the controlling program in response to
the UDP packet.</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;So2sdr&gt;
  &lt;bandmap RadioNr="1" freq="14022977" call="N4OGW" operation="delete"/&gt;
  &lt;/So2sdr&gt;
</code></pre></div>    </div>
  </li>
</ul>


                    </div>
                
            </div>

            

            <div class="row">
                <div id="footer" class="col-sm-12">
                    Documentation for <a href="https://github.com/n4ogw/so2sdr">So2sdr</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
        
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');
</script>

        
    </body>
</html>
